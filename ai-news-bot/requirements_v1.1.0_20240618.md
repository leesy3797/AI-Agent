# AI 뉴스 텔레그램 봇 개발 요구사항 정의서 (v1.2)

## 1. 프로젝트 개요

### 1.1. 프로젝트명
* AI Times 뉴스 브리핑 및 대화형 챗봇 텔레그램 봇

### 1.2. 프로젝트 목표
* 지정된 AI 뉴스 웹사이트(`aitimes.com`)의 최신 기사를 자동으로 수집 및 요약하고, 이를 텔레그램 봇을 통해 사용자에게 뉴스레터 형식으로 제공합니다. 또한, 사용자가 기사 내용에 대해 깊이 있는 질문을 할 수 있는 AI 에이전트 기반의 챗봇 기능을 제공하여 뉴스 소비 경험을 극대화합니다.

### 1.3. 기대 효과
* 매일 아침 AI 분야의 최신 트렌드 및 뉴스를 놓치지 않고 습득 가능
* 단순 뉴스 전달을 넘어, 대화를 통해 기사에 대한 이해도를 높임
* 관심 있는 정보만 선별하여 시간을 효율적으로 사용

## 2. 주요 기능 명세

### 2.1. 뉴스 수집 및 처리 (백엔드) ✅ **구현 완료**
* **수집 대상**: `https://www.aitimes.com/` 및 `https://www.aitimes.com/news/articleList.html?view_type=sm`
* **수집 방식**: 주기적인 웹 크롤링/스크래핑을 통해 새 기사의 제목, 본문, 원문 링크, 게시 날짜 등의 데이터를 추출합니다.
* **데이터 관리**:
    * 수집된 기사 정보(URL, 제목, 본문 등)는 PostgreSQL 데이터베이스에 저장합니다.
    * 기사의 URL을 고유 키(Primary Key)로 사용하여 중복 수집을 방지합니다.
    * 각 사용자에 대해 어떤 기사까지 알림을 받았는지 상태를 기록하여, 이전에 보낸 뉴스는 다시 보내지 않습니다.

### 2.2. 텔레그램 봇 인터페이스 (사용자 경험) ✅ **구현 완료**
#### 2.2.1. 정기 뉴스 브리핑 (푸시 알림) ✅ **구현 완료**
* **작동 방식**: 매일 오전 9시 정각, 지정된 사용자에게 새로운 뉴스 알림을 보냅니다.
* **조건**: 지난번 알림 이후 새로 수집된 기사가 있을 경우에만 작동합니다.
* **메시지 형식**:
    1.  "새로운 N개의 AI 뉴스 기사가 도착했습니다." 와 같은 안내 메시지
    2.  새로운 기사 제목들을 한 번에 **5개씩 나누어** 목록 형태로 보여줍니다. (페이지네이션)
    3.  만약 보여줄 기사가 더 있다면, 목록 하단에 `[더 보기]`와 같은 `Inline Keyboard` 버튼을 추가하여 사용자가 다음 목록을 요청할 수 있도록 합니다.
    4.  각 기사 제목은 사용자가 선택할 수 있는 `Inline Keyboard` 버튼으로 제공됩니다.

#### 2.2.2. 사용자 요청 기반 뉴스 제공 (풀 알림) ✅ **구현 완료**
* **작동 방식**: 사용자가 텔레그램 봇 채팅창에 `/news` 또는 `새 뉴스 알려줘` 와 같은 특정 명령어를 입력하면 작동합니다.
* **메시지 형식**: 정기 브리핑과 동일하게, 사용자가 아직 확인하지 않은 새로운 뉴스 목록을 **5개씩 나누어** `Inline Keyboard`와 함께 제공합니다.

#### 2.2.3. 기사 요약 및 링크 제공 ✅ **구현 완료**
* **작동 방식**: 사용자가 `Inline Keyboard`로 특정 기사 제목을 선택했을 때 작동합니다.
* **메시지 형식**:
    1.  선택된 기사의 본문을 Google Gemini 1.5 Flash를 통해 3~5문장으로 요약하여 텍스트로 제공합니다.
    2.  요약문 하단에 `[원문 기사 보기]`와 `[이 기사로 대화하기]` 두 개의 `Inline Keyboard` 버튼을 함께 제공합니다.
    3.  `[원문 기사 보기]` 버튼은 해당 기사의 원본 웹페이지 링크를 포함합니다.

### 2.3. AI 에이전트 기반 챗봇 (LangGraph) ✅ **구현 완료**
* **작동 방식**: 사용자가 `[이 기사로 대화하기]` 버튼을 누르거나, 뉴스 요약을 받은 후 후속 질문을 하면 챗봇 기능이 활성화됩니다.
* **아키텍처**: **`LangGraph`의 Agentic RAG 방식**을 기반으로 한 AI 에이전트로 구성되며, 다음과 같은 절차로 사용자의 질문에 답변합니다.
    1.  **1단계 (현재 기사 내용 검색)**: 사용자의 질문에 대한 답변을 현재 대화 중인 기사 본문 내용에서 찾습니다. (VectorDB 내 특정 기사 벡터 검색)
    2.  **2단계 (전체 기사 내용 검색)**: 1단계에서 답변을 찾지 못하면, 지금까지 수집된 **모든** 기사 데이터베이스에서 관련 내용을 검색합니다. (VectorDB 내 전체 기사 벡터 검색)
    3.  **3단계 (인터넷 검색)**: 2단계에서도 답변을 찾지 못하면, 외부 인터넷 검색 도구(DuckDuckGo)를 사용하여 웹에서 정보를 찾아 답변을 생성합니다.
* **대화 메모리**: 이전 대화 내용을 기억하여, 문맥에 맞는 자연스러운 대화가 가능해야 합니다.
* **컨텍스트 평가**: Gemini 2.0 Flash를 사용하여 검색된 컨텍스트가 사용자 질문에 충분한지 평가하는 grader 기능이 구현되어 있습니다.

## 3. 시스템 아키텍처 및 기술 스택

### 3.1. 전체 시스템 구성도 (현재 구현 상태)
* `사용자` ↔ `텔레그램 API` ↔ **`Python 봇 서버 (bot.py)`**
    * **`Python 봇 서버` 내부 구성**:
        * `Telegram 핸들러` (python-telegram-bot)
        * `스케줄러 (APScheduler)` ✅
        * `웹 크롤러 (BeautifulSoup, Requests)` ✅
        * `데이터베이스 (PostgreSQL + SQLAlchemy)` ✅
        * `VectorDB (FAISS + BM25 앙상블)` ✅
        * `LangGraph 에이전트 (AdaptiveRAGAgent)` ✅

### 3.2. 현재 기술 스택 (실제 구현)
* **개발 언어**: `Python 3.9+`
* **텔레그램 봇**: `python-telegram-bot==22.1`
* **웹 스크래핑**: `Requests==2.32.4`, `BeautifulSoup4==4.13.4`
* **AI/LLM 오케스트레이션**: `LangChain==0.3.25`, `LangGraph==0.4.8`
* **LLM**: `Google Gemini 1.5 Flash` (요약용), `Google Gemini 2.0 Flash` (컨텍스트 평가용)
* **VectorDB**: `FAISS` + `BM25 앙상블 리트리버`
* **메타데이터 DB**: `PostgreSQL` + `SQLAlchemy==2.0.41`
* **백그라운드 작업 스케줄링**: `APScheduler==3.11.0`
* **외부 검색**: `DuckDuckGo Search API`
* **실행 환경**: 24시간 실행을 위한 서버 (클라우드 서비스: AWS, GCP, Heroku 또는 개인 서버)

### 3.3. 프로젝트 구조 (현재 상태)
```
ai-news-bot/
├── bot.py                          # 메인 봇 실행 파일
├── requirements.txt                # 의존성 패키지 목록
├── requirements_v1.1.0_20240618.md # 요구사항 정의서
├── README.md                       # 프로젝트 설명서
├── agentic-rag-tutorial.ipynb      # LangGraph 튜토리얼 노트북
└── src/
    ├── __init__.py
    ├── agents/
    │   ├── __init__.py
    │   ├── adaptive_rag_agent.py   # LangGraph 에이전트 구현
    │   └── agent_test.ipynb        # 에이전트 테스트
    ├── crawler/
    │   ├── __init__.py
    │   ├── aitimes.py              # AI Times 크롤러
    │   └── test_crawler.py         # 크롤러 테스트
    ├── database/
    │   ├── __init__.py
    │   ├── connection.py           # DB 연결 관리
    │   ├── crud.py                 # CRUD 작업
    │   ├── initialize.py           # DB 초기화
    │   └── models.py               # SQLAlchemy 모델
    └── vectorstore/                # FAISS 벡터 저장소
```

## 4. 개발 단계 및 현재 상태

### 4.1. 개발 단계 (현재 상태)
1.  **✅ 1단계: 기반 구축 완료**
    * 텔레그램 봇 연동 완료
    * 스크래핑 로직 개발 완료 (AITimesCrawler)
    * DB 저장 기능 구현 완료 (PostgreSQL + SQLAlchemy)
    * 기본 봇 명령어 구현 완료 (/start, /help, /news)

2.  **✅ 2단계: 핵심 기능 구현 완료**
    * 정기/요청 기반 알림 구현 완료
    * 페이지네이션 기능 구현 완료 (5개씩 표시)
    * 기사 요약 기능 구현 완료 (Gemini 1.5 Flash)
    * 사용자별 읽은 기사 관리 완료

3.  **✅ 3단계: AI 기능 연동 완료**
    * 기사 요약 기능 완료
    * VectorDB 파이프라인 구축 완료 (FAISS + BM25 앙상블)
    * LangGraph 에이전트 구현 완료 (AdaptiveRAGAgent)
    * 3단계 검색 시스템 구현 완료 (기사 → 전체 → 인터넷)

4.  **🔄 4단계: 고도화 및 배포 (진행 중)**
    * 대화 메모리 구현 완료
    * 오류 처리 강화 필요
    * 서버 배포 준비 중
    * 성능 최적화 필요

### 4.2. 주요 구현 완료 사항
* **크롤러**: AI Times 웹사이트 크롤링 및 DB 저장
* **봇 인터페이스**: 텔레그램 봇 명령어 및 인라인 키보드
* **스케줄러**: 매일 오전 9시 자동 크롤링
* **데이터베이스**: PostgreSQL 기반 기사 및 사용자 관리
* **벡터 검색**: FAISS + BM25 앙상블 리트리버
* **AI 에이전트**: LangGraph 기반 3단계 검색 시스템
* **기사 요약**: Gemini 1.5 Flash 기반 요약 생성

### 4.3. 향후 개선 사항
* **성능 최적화**: 대용량 데이터 처리 최적화
* **오류 처리**: 더 강력한 예외 처리 및 복구 메커니즘
* **모니터링**: 로깅 및 성능 모니터링 시스템
* **배포**: Docker 컨테이너화 및 클라우드 배포
* **확장성**: 다중 사용자 동시 처리 최적화

### 4.4. 주요 고려사항
* **웹사이트 구조 변경**: `aitimes.com`의 HTML 구조가 변경되면 스크래핑 코드가 작동하지 않을 수 있으므로, 이에 대한 오류 처리 및 유지보수 계획이 필요합니다.
* **API 비용**: Google Gemini API 및 외부 검색 도구 API는 사용량에 따라 비용이 발생할 수 있으므로, 개발 및 운영 시 비용 계획을 고려해야 합니다.
* **처리 방식**: 현재 **동기(Synchronous) 방식**으로 구현되어 있으며, 추후 프로덕션 레벨로 전환 시, 다수 사용자의 동시 요청을 효율적으로 처리하기 위해 **비동기(Asynchronous) 처리** 도입을 고려합니다.
* **데이터 백업**: PostgreSQL 데이터베이스 및 FAISS 벡터 인덱스의 정기적인 백업이 필요합니다.